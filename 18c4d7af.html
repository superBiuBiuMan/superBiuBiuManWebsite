<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>油猴(篡改猴)学习记录 | 梦洁小站-属于你我的小天地</title><meta name="author" content="梦洁"><meta name="copyright" content="梦洁"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一个Hello World 注意点:默认只匹配了http网站,如果需要https网站,需要自己添加@match   https:&#x2F;&#x2F;*&#x2F;* 代码如下 这样子访问任意网站就可以输出Hello World    12345678910111213141516&#x2F;&#x2F; &#x3D;&#x3D;UserScript&#x3D;&#x3D;&#x2F;&#x2F; @name         第一个脚本&#x2F;&#x2F; @namespace    http:&#x2F;&#x2F;tampermon"><meta property="og:type" content="article"><meta property="og:title" content="油猴(篡改猴)学习记录"><meta property="og:url" content="https://www.dreamlove.top/18c4d7af.html"><meta property="og:site_name" content="梦洁小站-属于你我的小天地"><meta property="og:description" content="第一个Hello World 注意点:默认只匹配了http网站,如果需要https网站,需要自己添加@match   https:&#x2F;&#x2F;*&#x2F;* 代码如下 这样子访问任意网站就可以输出Hello World    12345678910111213141516&#x2F;&#x2F; &#x3D;&#x3D;UserScript&#x3D;&#x3D;&#x2F;&#x2F; @name         第一个脚本&#x2F;&#x2F; @namespace    http:&#x2F;&#x2F;tampermon"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181436823.png"><meta property="article:published_time" content="2023-09-27T19:16:00.000Z"><meta property="article:modified_time" content="2023-09-27T19:16:00.000Z"><meta property="article:author" content="梦洁"><meta property="article:tag" content="javascript"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181436823.png"><link rel="shortcut icon" href="https://oss.ypggb.com/i/2025/07/01/pk26bw.png"><link rel="canonical" href="https://www.dreamlove.top/18c4d7af.html"><link rel="preconnect" href="https://lib.baomitu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://lib.baomitu.com/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancyapps-ui/5.0.33/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"G7A2D1SYPY",apiKey:"49056313a9be02852c7dbedfcb772831",indexName:"blog",hits:{per_page:20},languages:{input_placeholder:"搜索文章",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://lib.baomitu.com/egjs-infinitegrid/4.11.1/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"油猴(篡改猴)学习记录",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-09-27 19:16:00"}</script><script>(e=>{e.saveToLocal={set:(e,t,o)=>{if(0===o)return;const a={value:t,expiry:Date.now()+864e5*o};localStorage.setItem(e,JSON.stringify(a))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!(Date.now()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},Object.keys(t).forEach(e=>{n.setAttribute(e,t[e])}),document.head.appendChild(n)}),e.getCSS=(e,t=!1)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onerror=a,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,o())},document.head.appendChild(n)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://oss.ypggb.com/i/2025/07/01/pk26bw.png" onerror='onerror=null,src="/img/404.png"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">182</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">101</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">73</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情和链接</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fas fa-link"></i><span> 链接导航</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 私有化导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://mark.123916.xyz/"><i class="fa-fw fas fa-database"></i><span> 导航</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://cloud.reassurehome.com/"><i class="fa-fw fas fa-hippo"></i><span> Alist(私有)</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://short.123916.xyz/027a2"><i class="fa-fw fas fa-paperclip"></i><span> clash免费订阅地址</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://short.123916.xyz/admin/"><i class="fa-fw fas fa-paperclip"></i><span> 短链接生成</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 好玩的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://make.girls.moe/#/"><i class="fa-fw fas fa-database"></i><span> 动漫头像制作</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://dfqshy.ysepan.com/"><i class="fa-fw fas fa-database"></i><span> FC游戏大全网盘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.yikm.net/"><i class="fa-fw fas fa-database"></i><span> 小霸王</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.return8090.com/"><i class="fa-fw fas fa-database"></i><span> 小霸王(广告多)</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://farm.dreamlove.top"><i class="fa-fw fas fa-database"></i><span> QQ农场经典版</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://codepip.com/"><i class="fa-fw fas fa-database"></i><span> CssGame</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://photo.123916.xyz/"><i class="fa-fw fas fa-database"></i><span> 有趣的照片</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://buy.dreamlove.top/"><i class="fa-fw fas fa-heart"></i><span> 购物</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181436823.png)"><nav id="nav"><span id="blog-info"><a href="/" title="梦洁小站-属于你我的小天地"><span class="site-name">梦洁小站-属于你我的小天地</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情和链接</span></a></div><div class="menus_item"><a class="site-page" href="/navigation/"><i class="fa-fw fas fa-link"></i><span> 链接导航</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 私有化导航</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://mark.123916.xyz/"><i class="fa-fw fas fa-database"></i><span> 导航</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://cloud.reassurehome.com/"><i class="fa-fw fas fa-hippo"></i><span> Alist(私有)</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://short.123916.xyz/027a2"><i class="fa-fw fas fa-paperclip"></i><span> clash免费订阅地址</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://short.123916.xyz/admin/"><i class="fa-fw fas fa-paperclip"></i><span> 短链接生成</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 好玩的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://make.girls.moe/#/"><i class="fa-fw fas fa-database"></i><span> 动漫头像制作</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://dfqshy.ysepan.com/"><i class="fa-fw fas fa-database"></i><span> FC游戏大全网盘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.yikm.net/"><i class="fa-fw fas fa-database"></i><span> 小霸王</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://www.return8090.com/"><i class="fa-fw fas fa-database"></i><span> 小霸王(广告多)</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://farm.dreamlove.top"><i class="fa-fw fas fa-database"></i><span> QQ农场经典版</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://codepip.com/"><i class="fa-fw fas fa-database"></i><span> CssGame</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://photo.123916.xyz/"><i class="fa-fw fas fa-database"></i><span> 有趣的照片</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://buy.dreamlove.top/"><i class="fa-fw fas fa-heart"></i><span> 购物</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">油猴(篡改猴)学习记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-27T19:16:00.000Z" title="发表于 2023-09-27 19:16:00">2023-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-27T19:16:00.000Z" title="更新于 2023-09-27 19:16:00">2023-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/HTML/">HTML</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/HTML/javascript/">javascript</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="油猴(篡改猴)学习记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第一个Hello-World"><a href="#第一个Hello-World" class="headerlink" title="第一个Hello World"></a>第一个Hello World</h1><ul><li>注意点:默认只匹配了<code>http</code>网站,如果需要<code>https</code>网站,需要自己添加<code>@match https://*/*</code></li><li>代码如下<ul><li>这样子访问任意网站就可以输出<code>Hello World</code></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         第一个脚本</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        http://*/*</span></span><br><span class="line"><span class="comment">// @match        https://*/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你好,世界&quot;</span>)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><ul><li>后期熟练了,可以用框架开发了,这个不错<ul><li><a target="_blank" rel="noopener" href="https://github.com/lisonge/vite-plugin-monkey">https://github.com/lisonge/vite-plugin-monkey</a></li></ul></li></ul><h1 id="重要了解"><a href="#重要了解" class="headerlink" title="重要了解"></a>重要了解</h1><h2 id="grant"><a href="#grant" class="headerlink" title="@grant"></a>@grant</h2><ul><li><p><code>@grant</code> 用于将 <code>GM_*</code> 和 <code>GM.*</code> 函数、 <code>unsafeWindow</code> 对象和一些强大的 <code>window</code> 函数列入白名单。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @grant GM_setValue</span></span><br><span class="line"><span class="comment">// @grant GM_getValue</span></span><br><span class="line"><span class="comment">// @grant GM.setValue</span></span><br><span class="line"><span class="comment">// @grant GM.getValue</span></span><br><span class="line"><span class="comment">// @grant GM_setClipboard</span></span><br><span class="line"><span class="comment">// @grant unsafeWindow</span></span><br><span class="line"><span class="comment">// @grant window.close</span></span><br><span class="line"><span class="comment">// @grant window.focus</span></span><br><span class="line"><span class="comment">// @grant window.onurlchange</span></span><br></pre></td></tr></table></figure></li><li><p>由于关闭和聚焦选项卡是一个强大的功能，因此也需要将其添加到 <code>@grant</code> 语句中。如果 <code>@grant</code> 后跟 <code>none</code> ，则禁用沙盒。在此模式下，没有 <code>GM_*</code> 函数，但 <code>GM_info</code> 属性将可用。</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @grant none</span></span><br></pre></td></tr></table></figure><ul><li>如果没有给定 <code>@grant</code> 标记，则假定为空列表。但是，这与使用 <code>none</code> 不同。</li><li>说白了就是你不设置<code>@grant</code>标记,你就不能使用<code>GM_addElement</code>等等<code>GM_</code>的函数</li></ul><h2 id="match"><a href="#match" class="headerlink" title="@match"></a>@match</h2><ul><li>主要运行脚本的网站</li><li>如果需要在全部链接上运行,就只需添加如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@match *:<span class="comment">//*/*</span></span><br></pre></td></tr></table></figure><ul><li>需要注意的是<code>@match</code>规则是匹配多少次,就运行多少次编写的脚本文件</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021113757.png"></p><ul><li>下面的例子就可以很好的说明match几次就执行多少次脚本</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// @match        http://www.yinghuavideo.com/v/*</span><br><span class="line">// @match        https://tup.yinghuavideo.com/*</span><br><span class="line">// 输出查看</span><br><span class="line">console.log(window.location.href)</span><br><span class="line"></span><br><span class="line">//输出如下内容</span><br><span class="line">	//第一次输出</span><br><span class="line">http://www.yinghuavideo.com/v/5971-9.html</span><br><span class="line">	//第二次输出</span><br><span class="line">https://tup.yinghuavideo.com/?vid=https://cdn18.vipyz-cdn3.com/20230902/15434_377b32aa/index.m3u8$mp4</span><br></pre></td></tr></table></figure><h2 id="require"><a href="#require" class="headerlink" title="@require"></a>@require</h2><ul><li><p>油猴给我们提供了一个@require属性给我们来引用用户脚本,并且油猴给我们提供了md5,sha256等校验方法来校验引用的脚本是否正确,例如下面这样:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @require      https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.min.js#md5=xxxx</span></span><br></pre></td></tr></table></figure></li><li><p>如果md5不正确,console中则会显示下面的内容</p></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309020941665.png"></p><ul><li>也支持 <code>SHA-256</code> 和 <code>MD5</code> 哈希</li><li>如果给出多个哈希（用逗号或分号分隔），则当前支持的最后一个哈希值由 Tampermonkey 使用。所有哈希都需要以十六进制或 Base64 格式编码。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// @require              https://code.jquery.com/jquery-2.1.1.min.js#md5=45eef...</span><br><span class="line">// @require              https://code.jquery.com/jquery-2.1.2.min.js#md5-ac56d...,sha256-6e789...</span><br><span class="line">// @require              https://code.jquery.com/jquery-3.6.0.min.js#sha256-/xUj+3OJU...ogEvDej/m4=</span><br></pre></td></tr></table></figure><h2 id="resource"><a href="#resource" class="headerlink" title="@resource"></a>@resource</h2><ul><li><p>一些可以通过<code>GM_getResourceText</code>和<code>GM_getResourceURL</code>访问的静态资源。 后面写名值对，名是资源的名称，值是相应的url，中间以空格隔开（所以名字中不能包含空格😄）,可多次定义</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// @resource logo https://my.cdn.com/logo.png</span><br><span class="line">// @resource text https://my.cdn.com/some-text.txt</span><br></pre></td></tr></table></figure></li><li><p>然后就可以使用<code>getResourceText</code>引入了</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         TEST调试专用</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.csdn.net/jx520</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @author       jerryjin</span></span><br><span class="line"><span class="comment">// @match        *://*/*</span></span><br><span class="line"><span class="comment">// @grant        GM_getResourceText</span></span><br><span class="line"><span class="comment">// @resource myTxt https://cdn.jsdelivr.net/gh/wandou-cc/blog-ui@20230314_v1/index.css</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line">(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> txt = <span class="title function_">GM_getResourceText</span>(<span class="string">&#x27;myTxt&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(txt);</span><br><span class="line">    <span class="keyword">let</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(txt);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(json);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h2 id="GM-addElement"><a href="#GM-addElement" class="headerlink" title="@GM_addElement"></a>@GM_addElement</h2><ul><li>可以用来添加<code>script</code>,<code>css</code>,或者为指定的DOM添加对应属性或元素</li></ul><h3 id="添加script-1"><a href="#添加script-1" class="headerlink" title="添加script-1"></a>添加script-1</h3><ul><li><code>head</code>下添加</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_addElement</span>(<span class="string">&#x27;script&#x27;</span>,&#123;</span><br><span class="line">	<span class="attr">textContent</span>: <span class="string">&quot; window.foo = &#x27;bar&#x27; &quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306161604117.png"></p><h3 id="添加script-指向url"><a href="#添加script-指向url" class="headerlink" title="添加script-指向url"></a>添加script-指向url</h3><ul><li><code>head</code>下添加</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_addElement</span>(<span class="string">&#x27;script&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">src</span>:<span class="string">&#x27;https://example.com/script.js&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;text/javascript&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306161606325.png"></p><h3 id="添加style和css的link"><a href="#添加style和css的link" class="headerlink" title="添加style和css的link"></a>添加style和css的link</h3><ul><li>下面这个操作就不解释什么意思了,应该都看得懂</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_addElement</span>(<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;div&#x27;</span>)[<span class="number">0</span>], <span class="string">&#x27;img&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">src</span>: <span class="string">&#x27;https://example.com/image.png&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">GM_addElement</span>(shadowDOM, <span class="string">&#x27;style&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">textContent</span>: <span class="string">&#x27;div &#123; color: black; &#125;;&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><code>style</code>应该这么用</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_addElement</span>(<span class="string">&quot;style&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">textContent</span>: <span class="string">`</span></span><br><span class="line"><span class="string">  body #git-hub-box-bt &#123;</span></span><br><span class="line"><span class="string">    background: #242429 !important;</span></span><br><span class="line"><span class="string">    border-color: #555666 !important</span></span><br><span class="line"><span class="string">&#125;`</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306161612452.png"></p><h2 id="GM-addStyle"><a href="#GM-addStyle" class="headerlink" title="@GM_addStyle"></a>@GM_addStyle</h2><ul><li>传入的参数就是css样式,css样式这么写,这里就可以写,用模板语法会很方便,和css书写一样,下面例子就是模板语法添加的样式信息</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_addStyle</span>(</span><br><span class="line">  <span class="string">`</span></span><br><span class="line"><span class="string">    .abc&#123;</span></span><br><span class="line"><span class="string">      position:absolute;</span></span><br><span class="line"><span class="string">      left:0;</span></span><br><span class="line"><span class="string">      right:0;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    #id&#123;</span></span><br><span class="line"><span class="string">      background:red,</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    body&#123;</span></span><br><span class="line"><span class="string">      padding-left:10px;</span></span><br><span class="line"><span class="string">      background:blue;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306161619670.png"></p><h2 id="GM-setValue"><a href="#GM-setValue" class="headerlink" title="@GM_setValue"></a>@GM_setValue</h2><ul><li><code>GM_setValue(key,value)</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GM_setValue(&quot;someKey&quot;, &quot;someData&quot;);</span><br><span class="line">await GM.setValue(&quot;otherKey&quot;, &quot;otherData&quot;);</span><br></pre></td></tr></table></figure><ul><li>暂时不明白为什么需要<code>await</code></li></ul><h2 id="GM-getValue"><a href="#GM-getValue" class="headerlink" title="@GM_getValue"></a>@GM_getValue</h2><ul><li><code>GM_getValue(key,defaultValue)</code><ul><li>当<code>key</code>不存在的时候,则返回默认值</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> someKey = <span class="title function_">GM_getValue</span>(<span class="string">&quot;someKey&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> otherKey = <span class="keyword">await</span> <span class="variable constant_">GM</span>.<span class="title function_">getValue</span>(<span class="string">&quot;otherKey&quot;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h2 id="GM-deleteValue"><a href="#GM-deleteValue" class="headerlink" title="@GM_deleteValue"></a>@GM_deleteValue</h2><ul><li><code>GM_deleteValue(&quot;someKey&quot;)</code></li><li>从用户脚本的存储中删除对应的key</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">GM_deleteValue</span>(<span class="string">&quot;someKey&quot;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="variable constant_">GM</span>.<span class="title function_">deleteValue</span>(<span class="string">&quot;otherKey&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="GM-listValues"><a href="#GM-listValues" class="headerlink" title="@GM_listValues"></a>@GM_listValues</h2><ul><li><code>GM_listValues</code> 函数返回所有存储数据的<code>key</code>列表。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> keys = <span class="title function_">GM_listValues</span>();</span><br><span class="line"><span class="keyword">const</span> asyncKeys = <span class="keyword">await</span> <span class="variable constant_">GM</span>.<span class="title function_">listValues</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//刚刚设置了</span></span><br><span class="line"><span class="comment">//GM_setValue(&#x27;sexInfo&#x27;,JSON.stringify(&#123;</span></span><br><span class="line"><span class="comment">//  name:&#x27;李白&#x27;,</span></span><br><span class="line"><span class="comment">//  age:18,</span></span><br><span class="line"><span class="comment">//  sex:&#x27;男&#x27;,</span></span><br><span class="line"><span class="comment">//&#125;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//输出 数组: [&#x27;sexInfo&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">GM_listValues</span>());</span><br></pre></td></tr></table></figure><h2 id="unsafeWindow"><a href="#unsafeWindow" class="headerlink" title="unsafeWindow"></a>unsafeWindow</h2><ul><li>作用:允许脚本可以完整访问原始页面，包括原始页面的脚本和变量。</li><li>简单理解为自己脚本里面的<code>window</code>是独立于外面的,无法访问到原始网页的<code>window</code>对象里面的信息</li><li>注意<code>unsafeWindow</code>和<code>window</code>是不一样的</li><li>比如有一个网页,代码如下</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> from4 = <span class="string">&#x27;我是来自网页4.html的内容&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>然后我们<code>@grant</code>引入<code>unsafeWindow</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//油猴脚本内容如下</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">from4</span>,unsafeWindow.<span class="property">from4</span>);</span><br><span class="line"><span class="comment">//网页输出结果为</span></span><br><span class="line"><span class="comment">// undefined &#x27;我是来自网页4.html的内容&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>可以看到,我们在代码直接访问<code>window</code>是获取不到的,需要使用<code>unsafeWindow</code></li></ul><h2 id="GM-registerMenuCommand"><a href="#GM-registerMenuCommand" class="headerlink" title="@GM_registerMenuCommand"></a>@GM_registerMenuCommand</h2><ul><li><p><code>GM_registerMenuCommand(name, callback, accessKey);</code></p><ul><li><p><strong>name</strong>: 包含要为菜单项显示的文本的字符串。</p></li><li><p><strong>callback</strong>: 回调：选择菜单项时要调用的函数。该函数将传递单个参数，即当前活动的选项卡。从Tampermonkey 4.14开始，MouseEvent或KeyboardEvent作为函数参数传递。</p></li><li><p><strong>accessKey</strong>: 访问键：菜单项的可选访问键。这可用于为菜单项创建快捷方式。例如，如果访问键为“s”，则用户可以在打开Tampermonkey的弹出菜单时按“s”来选择菜单项。</p></li></ul></li><li><p><strong>该函数返回可用于注销命令的菜单项 ID</strong>。</p><ul><li>也就是通过<code>GM_unregisterMenuCommand(menuCmdId)</code></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> menu_command_id = <span class="title function_">GM_registerMenuCommand</span>(<span class="string">&quot;Show Alert&quot;</span>, <span class="keyword">function</span>(<span class="params">event: MouseEvent | KeyboardEvent</span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;Menu item selected&quot;</span>);</span><br><span class="line">&#125;, <span class="string">&quot;a&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>如果需要通过<code>alt</code>或者<code>ctrl</code>这种组合键的,就需要如下的做法了</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> userSelfKey = <span class="string">&quot;h&quot;</span>; <span class="comment">//结合后面,设置用户按下alt + h 完成回调</span></span><br><span class="line">  <span class="comment">//点击后执行的回调</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">callback</span> =  (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击执行回调&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">GM_registerMenuCommand</span>(<span class="string">`是否启动(Alt+<span class="subst">$&#123;userSelfKey&#125;</span>)`</span>,);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((e.<span class="property">altKey</span>, e.<span class="property">key</span>.<span class="title function_">toLowerCase</span>() === userSelfKey)) &#123;</span><br><span class="line">      <span class="title function_">callback</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="run-at"><a href="#run-at" class="headerlink" title="@run-at"></a>@run-at</h2><ul><li>说通俗点就是代码什么时候注入(因为注入时机不同,可以对网页的操作量也不同)</li><li>官方文档 <a target="_blank" rel="noopener" href="https://www.tampermonkey.net/documentation.php#meta:run_at:~:text=%E5%A4%9A%E4%B8%AA%E6%A0%87%E8%AE%B0%E5%AE%9E%E4%BE%8B%E3%80%82-,%40run%2Dat,-Defines%20the%20moment">@地址</a></li><li>就如同作者说的,想要替换<code>setInterval</code>函数,达到时间加速,就必须在调用之前被替换,所以就应该更改<code>run-at</code>的值</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">首先来介绍一下时间加速的原理.一般情况下,都是使用<span class="built_in">setInterval</span>来做定时器,我们只要把这个定时器的时间缩短,比如之前是1s触发一次,现在变成500ms触发一次,那么就相当于时间缩短了一倍.</span><br><span class="line"></span><br><span class="line">怎么缩短呢?我们可以劫持<span class="built_in">setInterval</span>这个函数,传入值为<span class="number">1000</span>,我们把他变为<span class="number">500.</span>代码类似下面这样:</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hookSetInterval=<span class="variable language_">window</span>.<span class="property">setInterval</span>;<span class="comment">//将系统提供的setInterval保存</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">setInterval</span>=<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="comment">//将系统的setInterval替换为我们自己的</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">hookSetInterval</span>(a,b/<span class="number">2</span>);<span class="comment">//经过处理后再调用系统的setInterval</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="GM-xmlhttpRequest"><a href="#GM-xmlhttpRequest" class="headerlink" title="@GM_xmlhttpRequest"></a>@GM_xmlhttpRequest</h2><ul><li>和自带的ajax请求和fetch更强大,支持跨域这个<code>GM_xmlHttpRequest</code></li><li>重要提示：如果要使用此方法，请同时查看有关 <code>@connect</code> 的文档。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         02.GM_xmlhttpRequest演示</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://bbs.tampermonkey.net.cn/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day3\02.GM_xmlhttpRequest演示.js</span></span><br><span class="line"><span class="comment">// @grant        GM_xmlhttpRequest</span></span><br><span class="line"><span class="comment">// @connect      bbs.tampermonkey.net.cn</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="title function_">GM_xmlhttpRequest</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;https://bbs.tampermonkey.net.cn/home.php?mod=spacecp&amp;ac=favorite&amp;type=thread&amp;id=1268&amp;formhash=fa62a5ea&amp;infloat=yes&amp;handlekey=k_favorite&amp;inajax=1&amp;ajaxtarget=fwin_content_k_favorite&#x27;</span>,</span><br><span class="line">        <span class="attr">onload</span>: <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response,response.<span class="property">response</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="connect"><a href="#connect" class="headerlink" title="@connect"></a>@connect</h2><ul><li>设置允许通过<code>GM_xmlhttpRequest</code>连接访问的域名（包括子域名）。</li><li>说白了就是如果在调用<code>@GM_xmlhttpRequest</code>的时候,好像会有一个确认访问域的对话框</li></ul><h1 id="代码编写前置工作"><a href="#代码编写前置工作" class="headerlink" title="代码编写前置工作"></a>代码编写前置工作</h1><h2 id="前置工作1-require引入本地文件"><a href="#前置工作1-require引入本地文件" class="headerlink" title="前置工作1-@require引入本地文件"></a>前置工作1-@require引入本地文件</h2><ul><li>方式1:可以在油猴那边编写,然后运行</li><li>方法2:借助于<code>@require</code>引入本地文件,然后借助于第三方编辑器进行编写<ul><li>注意,需要开启<code>允许访问文件网址</code>才可以引入本地文件</li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306151412625.png"></p><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306151410917.png"></p><ul><li>然后将下面的文件路径替换为你自己的就好了<ul><li><code>@require file://文件路径</code>: 将文件路径替换为自己的</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         我的脚本开发</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        http://*/*</span></span><br><span class="line"><span class="comment">// @match        https://*/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      file://文件路径</span></span><br><span class="line"><span class="comment">//比如我的如下</span></span><br><span class="line"><span class="comment">// @require 	 file://D:\develop\phpstudy_pro\WWW\vue\classWork\油猴\1.helloworld.js</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="前置工作2-添加jQuery便携DOM操作"><a href="#前置工作2-添加jQuery便携DOM操作" class="headerlink" title="前置工作2-添加jQuery便携DOM操作"></a>前置工作2-添加jQuery便携DOM操作</h2><ul><li>如果不想用原生的或者原生的会用但是没jQuery方便,可以用jQuery来操作DOM,如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         我的脚本开发</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        http://*/*</span></span><br><span class="line"><span class="comment">// @match        https://*/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.js</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\vue\classWork\油猴\1.helloworld.js</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>这样子我们编写脚本直接就可以使用了<ul><li>下面是我文件的<code>helloworld.js</code>内容</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>($);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;你好,世界&quot;</span>)</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306151426913.png"></p><h1 id="代码正式编写"><a href="#代码正式编写" class="headerlink" title="代码正式编写"></a>代码正式编写</h1><h2 id="1-练习-1"><a href="#1-练习-1" class="headerlink" title="1.练习-1"></a>1.练习-1</h2><ul><li>一个网页添加一个可操作的方块,并有几个功能按钮,效果图如下</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202306151548549.png"></p><ul><li><p>测试网站</p><ul><li><a target="_blank" rel="noopener" href="https://dreamlove.top/53b29abd">https://dreamlove.top/53b29abd</a></li></ul></li><li><p>具体代码</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">  <span class="comment">//创建外层容器</span></span><br><span class="line">  <span class="keyword">const</span> wrapperDOM = $(<span class="string">`&lt;div&gt;&lt;/div&gt;`</span>).<span class="title function_">css</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">150</span>,</span><br><span class="line">    <span class="attr">backgroundColor</span>: <span class="string">&quot;hotpink&quot;</span>,</span><br><span class="line">    <span class="attr">position</span>: <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">60</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> button1DOM = $(<span class="string">&quot;&lt;button&gt;点击我滚动到底部&lt;/button&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> button2DOM = $(</span><br><span class="line">    <span class="string">&quot;&lt;button&gt;点击我将&#x27;梦洁小站-属于你我的小天地&#x27;更改为&#x27;这是我的天下了&#x27;&lt;/button&gt;&quot;</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> button3DOM = $(<span class="string">&quot;&lt;button&gt;点击我发表评论&lt;/button&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  button1DOM.<span class="title function_">click</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  button2DOM.<span class="title function_">click</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;site-title&quot;</span>).<span class="property">textContent</span> = <span class="string">&quot;这是我的天下了&quot;</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  button3DOM.<span class="title function_">click</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> temp = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;WALINE_COMMENT_BOX_EDITOR&quot;</span>);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;WALINE_USER_META&quot;</span>);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;WALINE_COMMENT_BOX_EDITOR&quot;</span>, <span class="string">&quot;自动填充评论&quot;</span> + temp);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(</span><br><span class="line">      <span class="string">&quot;WALINE_USER_META&quot;</span>,</span><br><span class="line">      <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">nick</span>: <span class="string">&quot;自动填充昵称&quot;</span> + temp,</span><br><span class="line">        <span class="attr">mail</span>: <span class="string">&quot;自动填充邮箱&quot;</span> + temp,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(<span class="number">0</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span>); <span class="comment">//先滚动到底部</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">scroll</span>(<span class="number">0</span>, <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  wrapperDOM.<span class="title function_">append</span>([button1DOM, button2DOM, button3DOM]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//添加到网页当中</span></span><br><span class="line">  $(<span class="string">&quot;html&quot;</span>).<span class="title function_">append</span>(wrapperDOM).<span class="title function_">css</span>(&#123;</span><br><span class="line">    <span class="attr">position</span>: <span class="string">&quot;relative&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-练习-2-CSDN黑夜模式"><a href="#2-练习-2-CSDN黑夜模式" class="headerlink" title="2.练习-2-CSDN黑夜模式"></a>2.练习-2-CSDN黑夜模式</h2><h3 id="2-1个人中心页面黑夜模式添加"><a href="#2-1个人中心页面黑夜模式添加" class="headerlink" title="2.1个人中心页面黑夜模式添加"></a>2.1个人中心页面黑夜模式添加</h3><ul><li>先观察vip用户和普通用户看看<ul><li>普通用户: <a target="_blank" rel="noopener" href="https://blog.csdn.net/wswq2505655377?type=blog">upward_tomato_javascript,vue,javascript复习之旅-CSDN博客</a></li><li>vip用户:<a target="_blank" rel="noopener" href="https://blog.csdn.net/LaoYuanPython?type=blog">LaoYuanPython_老猿Python,PyQt+moviepy音视频剪辑实战,OpenCV-Python图形图像处理-CSDN博客</a></li></ul></li><li>观察这二个人,后面发现一个类不同</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010941105.png"></p><ul><li>然后我们尝试把<code>user-skin-Black</code>添加上去,发现变化了</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010943312.png"></p><ul><li>我们书写下油猴脚本代码</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> skinDivDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userSkin&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(skinDivDOM.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;user-skin-Black&#x27;</span>))</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><ul><li>但是发现顶部还没有变化</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010944691.png"></p><ul><li>观察发现是这一个类的问题<ul><li>vip黑色背景为:<code>csdn-toolbar-dark.css</code></li><li>普通用户背景为:<code>csdn-toolbar-default.css</code></li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010947919.png"></p><ul><li>我们油猴试试添加下这个css文件看看,代码就变成了下面这样子<ul><li><code>@match</code>后期优化</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         day2-实现csdn黑色效果</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        *://*/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @resource darkToolBarCss https://g.csdnimg.cn/common/csdn-toolbar/csdn-toolbar-dark.css</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day2-实现csdn黑色效果\index.js</span></span><br><span class="line"><span class="comment">// @grant        GM_addStyle</span></span><br><span class="line"><span class="comment">// @grant        GM_getResourceText</span></span><br><span class="line"><span class="comment">// @grant        GM_addElement</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js内容</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> skinDivDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userSkin&#x27;</span>);</span><br><span class="line">    <span class="comment">//个人页面内容区黑色化</span></span><br><span class="line">    skinDivDOM.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;user-skin-Black&#x27;</span>)</span><br><span class="line">    <span class="comment">//顶部导航栏黑色化</span></span><br><span class="line">    <span class="keyword">const</span> darkToolBarCss = <span class="title function_">GM_getResourceText</span>(<span class="string">&#x27;darkToolBarCss&#x27;</span>)</span><br><span class="line">    <span class="title function_">GM_addStyle</span>(darkToolBarCss)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>添加完成后是这样子的</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010952084.png"></p><ul><li>发现差一点效果和vip的</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010953225.png" alt="vip效果"></p><ul><li>查看代码,然后优化后代码如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         day2-实现csdn黑色效果</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://blog.csdn.net/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @resource darkToolBarCss https://g.csdnimg.cn/common/csdn-toolbar/csdn-toolbar-dark.css</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day2-实现csdn黑色效果\index.js</span></span><br><span class="line"><span class="comment">// @grant        GM_addStyle</span></span><br><span class="line"><span class="comment">// @grant        GM_getResourceText</span></span><br><span class="line"><span class="comment">// @grant        GM_addElement</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js内容如下</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> skinDivDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userSkin&#x27;</span>);</span><br><span class="line">    <span class="comment">//个人页面内容区黑色化</span></span><br><span class="line">    skinDivDOM.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;user-skin-Black&#x27;</span>)</span><br><span class="line">    <span class="comment">//顶部导航栏黑色化</span></span><br><span class="line">    <span class="keyword">const</span> darkToolBarCss = <span class="title function_">GM_getResourceText</span>(<span class="string">&#x27;darkToolBarCss&#x27;</span>)</span><br><span class="line">    <span class="title function_">GM_addStyle</span>(darkToolBarCss)</span><br><span class="line">    <span class="comment">//顶部导航栏细节优化</span></span><br><span class="line">    <span class="keyword">const</span> toolBarDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#csdn-toolbar .toolbar-inside&#x27;</span>);</span><br><span class="line">    toolBarDOM.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&#x27;#242429&#x27;</span>;</span><br><span class="line">    <span class="comment">//顶部导航栏图片替换</span></span><br><span class="line">    <span class="keyword">const</span> toolBarImgDark = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#csdn-toolbar &gt; div &gt; div &gt; div.toolbar-container-left &gt; div &gt; a &gt; img&#x27;</span>);</span><br><span class="line">    toolBarImgDark.<span class="property">src</span> = <span class="string">&#x27;https://img-home.csdnimg.cn/images/20211028053651.png&#x27;</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2文章内容黑夜模式添加"><a href="#2-2文章内容黑夜模式添加" class="headerlink" title="2.2文章内容黑夜模式添加"></a>2.2文章内容黑夜模式添加</h3><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309010959038.png"></p><ul><li>老样子,观察下标题的样式,看看有什么区别<ul><li><strong>发现vip用户的黑色背景下的标题多了这个样式,而普通用户没有这个skin-clickm…1.min.css样式文件(不信看网络加载的css文件)</strong></li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309011000029.png"></p><ul><li>那就很简单了,优化下逻辑代码和添加css,结果如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         day2-实现csdn黑色效果</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://blog.csdn.net/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @resource darkToolBarCss https://g.csdnimg.cn/common/csdn-toolbar/csdn-toolbar-dark.css</span></span><br><span class="line"><span class="comment">// @resource darkArticleCss https://csdnimg.cn/release/blogv2/dist/pc/themesSkin/skin-clickmove/skin-clickmove-3ae5e69ee1.min.css</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day2-实现csdn黑色效果\index.js</span></span><br><span class="line"><span class="comment">// @grant        GM_addStyle</span></span><br><span class="line"><span class="comment">// @grant        GM_getResourceText</span></span><br><span class="line"><span class="comment">// @grant        GM_addElement</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 个人中心黑色背景化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> skinDivDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userSkin&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(skinDivDOM)&#123;</span><br><span class="line">        <span class="comment">//个人页面内容区黑色化</span></span><br><span class="line">        skinDivDOM.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;user-skin-Black&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//顶部导航栏黑色化</span></span><br><span class="line">    <span class="keyword">const</span> darkToolBarCss = <span class="title function_">GM_getResourceText</span>(<span class="string">&#x27;darkToolBarCss&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(!darkToolBarCss)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取顶部导航栏黑色化样式文件失败,请检查css链接是否失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">GM_addStyle</span>(darkToolBarCss)</span><br><span class="line">    <span class="comment">//顶部导航栏细节优化</span></span><br><span class="line">    <span class="keyword">const</span> toolBarDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#csdn-toolbar .toolbar-inside&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(toolBarDOM)&#123;</span><br><span class="line">        toolBarDOM.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&#x27;#242429&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//顶部导航栏图片替换</span></span><br><span class="line">    <span class="keyword">const</span> toolBarImgDark = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#csdn-toolbar &gt; div &gt; div &gt; div.toolbar-container-left &gt; div &gt; a &gt; img&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(toolBarImgDark)&#123;</span><br><span class="line">        toolBarImgDark.<span class="property">src</span> = <span class="string">&#x27;https://img-home.csdnimg.cn/images/20211028053651.png&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章黑色背景化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> darkArticleCss = <span class="title function_">GM_getResourceText</span>(<span class="string">&#x27;darkArticleCss&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!darkArticleCss)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取文章黑色背景化样式文件失败,请检查css链接是否失效&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">GM_addStyle</span>(darkArticleCss)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-脚本自动化之模拟点击和表单填写"><a href="#3-脚本自动化之模拟点击和表单填写" class="headerlink" title="3.脚本自动化之模拟点击和表单填写"></a>3.脚本自动化之模拟点击和表单填写</h2><ul><li>示例网站<ul><li><a target="_blank" rel="noopener" href="https://bbs.tampermonkey.net.cn/">油猴中文网 - 油猴脚本分享交流 - Powered by Discuz! (tampermonkey.net.cn)</a></li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name        01.脚本自动化之模拟点击和表单填写</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://bbs.tampermonkey.net.cn/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day3\01.脚本自动化之模拟点击和表单填写.js</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> loginNameDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input[name = &#x27;username&#x27;]&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> loginPassDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input[name = &#x27;password&#x27;]&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> loginBtnDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;button[name = &#x27;loginsubmit&#x27;]&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;循环&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span>(loginNameDOM &amp;&amp; loginPassDOM)&#123;</span><br><span class="line">            loginNameDOM.<span class="property">value</span> = <span class="string">&#x27;testAccount&#x27;</span>;</span><br><span class="line">            loginPassDOM.<span class="property">value</span> = <span class="string">&#x27;testPassword&#x27;</span></span><br><span class="line">            <span class="comment">//点击登录</span></span><br><span class="line">            loginBtnDOM.<span class="title function_">click</span>();</span><br><span class="line">            <span class="comment">//界面显示,清空循环</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-视频倍速播放"><a href="#4-视频倍速播放" class="headerlink" title="4.视频倍速播放"></a>4.视频倍速播放</h2><ul><li>借助于video元素身上的<code>playbackRate</code>属性即可<ul><li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/playbackRate">HTMLMediaElement.playbackRate - Web API 接口参考 | MDN (mozilla.org)</a></li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309011558717.png"></p><h2 id="5-bilibili一键三连"><a href="#5-bilibili一键三连" class="headerlink" title="5.bilibili一键三连"></a>5.bilibili一键三连</h2><ul><li>我们长按三连看看</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012040848.png"></p><ul><li>参数重要的几个</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">csrf: 发现是从cookie获取</span><br><span class="line"></span><br><span class="line">aid:发现可以通过window.__INITIAL_STATE__.aid来获取,至于为什么这样子,服务器渲染知识了,百度~</span><br><span class="line"></span><br><span class="line">其他几个可能和投银币数量有关的参数在里面,但是不管他了~</span><br></pre></td></tr></table></figure><ul><li>至于为什么是3秒,好像需要等页面加载完成后再插入,否则会无限刷新</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         03.b站一键三连</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://www.bilibili.com/video/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      https://cdn.bootcdn.net/ajax/libs/js-cookie/3.0.2/js.cookie.min.js</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day3\03.b站一键三连.js</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> videoBarDOM = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.video-toolbar-left&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> btnDOM = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">        btnDOM.<span class="property">textContent</span> = <span class="string">&#x27;三连&#x27;</span>;</span><br><span class="line">        btnDOM.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> aid = unsafeWindow.<span class="property">__INITIAL_STATE__</span>.<span class="property">aid</span>;</span><br><span class="line">            <span class="keyword">const</span> csrf = <span class="title class_">Cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;bili_jct&#x27;</span>);</span><br><span class="line">            <span class="title function_">fetch</span>(<span class="string">&#x27;https://api.bilibili.com/x/web-interface/archive/like/triple&#x27;</span>,&#123;</span><br><span class="line">                <span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                <span class="attr">headers</span>:&#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">credentials</span>:<span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">                <span class="attr">body</span>:<span class="string">`aid=<span class="subst">$&#123;aid&#125;</span>&amp;csrf=<span class="subst">$&#123;csrf&#125;</span>`</span>,</span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> code = result.<span class="property">code</span>;</span><br><span class="line">                <span class="keyword">if</span>(code === <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;三连成功!刷新页面可见&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">&quot;三连失败/(ㄒoㄒ)/~~&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        videoBarDOM.<span class="title function_">append</span>(btnDOM)</span><br><span class="line">    &#125;,<span class="number">3000</span>)</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-樱花动漫简易去广告"><a href="#6-樱花动漫简易去广告" class="headerlink" title="6.樱花动漫简易去广告"></a>6.樱花动漫简易去广告</h2><ul><li>打开樱花动漫,可以看到一堆广告<ul><li><a target="_blank" rel="noopener" href="http://www.yinghuavideo.com/v/5971-9.html">布莱泽奥特曼日语 09集—在线播放—樱花动漫，视频高清在线观看 (yinghuavideo.com)</a></li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021013024.png"></p><ul><li>原理很简单,<code>display:none</code>就可以隐藏了,视频播放暂停的广告一开始是<code>display:none</code>,暂停的时候被修改为<code>display:block</code>,所以我们把宽度,高度更改为0就可以了</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         05.樱花动漫简易去广告</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        http://www.yinghuavideo.com/v/*</span></span><br><span class="line"><span class="comment">// @match        https://tup.yinghuavideo.com/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day3\05.樱花动漫简易去广告.js</span></span><br><span class="line"><span class="comment">// @grant        GM_addStyle</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;yinghuavideo.com&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_">GM_addStyle</span>(<span class="string">`</span></span><br><span class="line"><span class="string">                #HMcoupletDivleft &#123;</span></span><br><span class="line"><span class="string">                    display:none !important;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                #HMcoupletDivright &#123;</span></span><br><span class="line"><span class="string">                    display:none !important;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">        `</span>);</span><br><span class="line">        <span class="comment">//移除右下角</span></span><br><span class="line">        <span class="keyword">const</span> ttt = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;divz&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (ttt) &#123;</span><br><span class="line">            ttt.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;tup.yinghuavideo.com&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> tempDOM = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;adv_wrap_hh&#x27;</span>);</span><br><span class="line">            <span class="comment">//超过一分钟还没加载出来,取消加载</span></span><br><span class="line">            <span class="keyword">if</span>(++i &gt;= <span class="number">60</span>)&#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//移除暂停视频广告</span></span><br><span class="line">            <span class="keyword">if</span> (tempDOM) &#123;</span><br><span class="line">                tempDOM.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">&#x27;width:0!important;height:0!important&#x27;</span>;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>效果</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021537191.png"></p><h2 id="7-bilibili小尾巴-hook思想"><a href="#7-bilibili小尾巴-hook思想" class="headerlink" title="7.bilibili小尾巴-hook思想"></a>7.bilibili小尾巴-hook思想</h2><ul><li>我们发送一个消息看看</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021543885.png"></p><ul><li>参数有下面这些</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021543790.png"></p><ul><li>发送的方式是<code>fetch</code></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021545769.png"></p><ul><li><p>有关于怎么拦截重写fetch,这个文章说的很好</p><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7166903919208038430">JavaScript 中如何拦截全局 Fetch API 的请求和响应？ - 掘金 (juejin.cn)</a></li></ul></li><li><p>这里就使用博主的猴子补丁(monkey patching)</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">fetch</span>: originalFetch &#125; = <span class="variable language_">window</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">fetch</span> = <span class="keyword">async</span> (...args) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> [resource, config ] = args;</span><br><span class="line">    <span class="comment">// request interceptor here</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">originalFetch</span>(resource, config);</span><br><span class="line">    <span class="comment">// response interceptor here</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>代码如下<ul><li><code>decodeURIComponent</code>目的是小尾巴所有的字符都编码,不管是不是特殊字符</li></ul></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         06.bilibili小尾巴-hook思想.js</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://www.bilibili.com/video/*</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @require      file://D:\develop\phpstudy_pro\WWW\studyMaster\油猴脚本\day3\06.bilibili小尾巴-hook思想.js</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.js</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> tailContent = <span class="string">&#x27;\n-----我是可爱的小尾巴&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">fetch</span>:originalFetch &#125; = unsafeWindow;</span><br><span class="line">    unsafeWindow.<span class="property">fetch</span> = <span class="keyword">async</span> (...args) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> [ resource,config ] = args;</span><br><span class="line">        <span class="comment">//resource 网站url</span></span><br><span class="line">        <span class="keyword">if</span>(resource.<span class="title function_">includes</span>(<span class="string">&#x27;api.bilibili.com/x/v2/reply/add&#x27;</span>))&#123;</span><br><span class="line">            <span class="comment">//config 请求设置</span></span><br><span class="line">            <span class="keyword">let</span> &#123; body &#125; = config || &#123;&#125;;</span><br><span class="line">            <span class="keyword">const</span> newBody = body.<span class="title function_">replace</span>(<span class="regexp">/message=(.*?)&amp;/</span>,<span class="function">(<span class="params">match,$1</span>) =&gt;</span> <span class="string">`message=<span class="subst">$&#123;$1&#125;</span><span class="subst">$&#123;<span class="built_in">decodeURIComponent</span>(tailContent)&#125;</span>&amp;`</span>)</span><br><span class="line">            config.<span class="property">body</span> = newBody;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">originalFetch</span>(resource,config);</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309021625852.png" alt="效果"></p><h1 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h1><ul><li>油猴官方文档<ul><li><a target="_blank" rel="noopener" href="https://www.tampermonkey.net/documentation.php">https://www.tampermonkey.net/documentation.php</a></li></ul></li><li>post请求提交的数据<ul><li>Content-Type:application&#x2F;x-www-form-urlencoded</li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012144267.png"></p><ul><li>点击查看源</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012145037.png"></p><ul><li>我们的却是这样子</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012152078.png"></p><ul><li>点击查看源</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012152524.png"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.bilibili.com/x/web-interface/archive/like/triple&#x27;</span>,&#123;</span><br><span class="line">       <span class="attr">method</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">       <span class="attr">headers</span>:&#123;</span><br><span class="line">           <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.62&#x27;</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="attr">credentials</span>:<span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">       <span class="attr">body</span>:<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">           aid,</span><br><span class="line">           csrf,</span><br><span class="line">           <span class="attr">eab_x</span>: <span class="number">2</span>,</span><br><span class="line">           <span class="attr">ramval</span>: <span class="number">13</span>,</span><br><span class="line">           <span class="attr">source</span>: <span class="string">&#x27;web_normal&#x27;</span>,</span><br><span class="line">           <span class="attr">ga</span>: <span class="number">1</span>,</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">   &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;结果&#x27;</span>,json)</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure><ul><li><p>错误原因,我使用了json方式发送数据,这种对应的Content-type应该为application&#x2F;json</p><ul><li>而哔哩哔哩那种是Content-Type为application&#x2F;x-www-form-urlencoded,也就是类似于key&#x3D;value&amp;key2&#x3D;value2…这种形式</li><li>而Content-Type为form-data,一般是文件上传的,如下图</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309012157023.png" alt="Content-Type为form-data"></p></li></ul><p>​</p><h1 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h1><h2 id="使用GM-xmlhttpRequest看不到请求怎么办"><a href="#使用GM-xmlhttpRequest看不到请求怎么办" class="headerlink" title="使用GM_xmlhttpRequest看不到请求怎么办?"></a>使用GM_xmlhttpRequest看不到请求怎么办?</h2><ul><li>找到扩展程序,点击下面的</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309301009295.png"></p><ul><li>然后会打开一个调试窗口,再次发送请求,就可以看到了</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309301010047.png"></p><h1 id="错误记录"><a href="#错误记录" class="headerlink" title="错误记录"></a>错误记录</h1><h2 id="because-it-violates-the-following-Content-Security-Policy-directive"><a href="#because-it-violates-the-following-Content-Security-Policy-directive" class="headerlink" title="because it violates the following Content Security Policy directive"></a>because it violates the following Content Security Policy directive</h2><ul><li>油猴运行出现这个</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">because it violates the following Content Security Policy directive: &quot;script-src *.weiyun.com *.qq.com *.gtimg.cn *.gtimg.com *.idqqimg.com *.idqqimg.cn *.tenpay.com *.qpic.cn *.url.cn *.qpimg.cn *.myqcloud.com cdn-go.cn cdn.addon.tencentsuite.com blob: &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;&quot;. Note that &#x27;script-src-elem&#x27; was not explicitly set, so &#x27;script-src&#x27; is used as a fallback.</span><br></pre></td></tr></table></figure><ul><li><p>github解决办法</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/lisonge/vite-plugin-monkey/issues/1">https://github.com/lisonge/vite-plugin-monkey/issues/1</a></li></ul></li><li><p>原来formData的append只能添加字符串形式的值,否则会出现这种问题,参数里面带<code>[]</code>,比如<code>file_id[]:132424</code></p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const formData = new FormData();</span><br><span class="line">            formData.append(&#x27;period&#x27;,expireTime.value + &#x27;&#x27;)</span><br><span class="line">            formData.append(&#x27;pwd&#x27;,&#x27;6666&#x27;)</span><br><span class="line">            formData.append(&#x27;eflag_disable&#x27;,&#x27;true&#x27;)</span><br><span class="line">            formData.append(&#x27;channel_list&#x27;,&#x27;[]&#x27;)</span><br><span class="line">            formData.append(&#x27;schannel&#x27;,&#x27;4&#x27;)</span><br><span class="line">            formData.append(&#x27;fid_list&#x27;,&#x27;[297649734372532]&#x27;)</span><br></pre></td></tr></table></figure><h3 id="还有-如果设置了formData发送post数据-一定要省略-xhr-setRequestHeader-‘Content-Type’-‘application-x-www-form-urlencoded’-这行代码-否者数据无法正常切割"><a href="#还有-如果设置了formData发送post数据-一定要省略-xhr-setRequestHeader-‘Content-Type’-‘application-x-www-form-urlencoded’-这行代码-否者数据无法正常切割" class="headerlink" title="还有,如果设置了formData发送post数据,一定要省略 xhr.setRequestHeader(‘Content-Type’, ‘application&#x2F;x-www-form-urlencoded’); 这行代码,否者数据无法正常切割"></a>还有,如果设置了formData发送post数据,一定要省略 xhr.setRequestHeader(‘Content-Type’, ‘application&#x2F;x-www-form-urlencoded’); 这行代码,否者数据无法正常切割</h3><ul><li>否者会出现服务器需要下面格式的数据</li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309301017416.png"></p><ul><li>因为手动设置了<code>Content-Type&#39;, &#39;application/x-www-form-urlencoded</code>,而导致的发送数据无法切割问题<ul><li>所以切记,切记</li></ul></li></ul><p><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202309301018744.png"></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.dreamlove.top">梦洁</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.dreamlove.top/18c4d7af.html">https://www.dreamlove.top/18c4d7af.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.dreamlove.top" target="_blank">梦洁小站-属于你我的小天地</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/javascript/">javascript</a></div><div class="post_share"><div class="social-share" data-image="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181436823.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://lib.baomitu.com/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://lib.baomitu.com/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/18c4d7af.html" title="网盘文件批量分享,目前支持百度网盘,天翼网盘,115网盘,123盘,夸克网盘,蓝奏云"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181438371.png" onerror='onerror=null,src="/img/404.png"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网盘文件批量分享,目前支持百度网盘,天翼网盘,115网盘,123盘,夸克网盘,蓝奏云</div></div></a></div><div class="next-post pull-right"><a href="/53b29abd.html" title="antd3和dva-自定义组件初始化值的操作演示和自定义组件校验"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181435851.png" onerror='onerror=null,src="/img/404.png"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">antd3和dva-自定义组件初始化值的操作演示和自定义组件校验</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/e4e505ca.html" title="使用vite的社区模板来创建对应的项目(比如React17,vue+electron)"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202304101645867.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-06</div><div class="title">使用vite的社区模板来创建对应的项目(比如React17,vue+electron)</div></div></a></div><div><a href="/5391ecf8.html" title="js的promise的究竟是同步还是异步的问题和promise.all可以同时请求多个接口是错误的回答的原因"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202304101653321.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-19</div><div class="title">js的promise的究竟是同步还是异步的问题和promise.all可以同时请求多个接口是错误的回答的原因</div></div></a></div><div><a href="/5dcd009d.html" title="使用backdrop-filter实现elementui官网的模糊滤镜效果的和毛玻璃效果"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202304101647316.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-25</div><div class="title">使用backdrop-filter实现elementui官网的模糊滤镜效果的和毛玻璃效果</div></div></a></div><div><a href="/8a2682cd.html" title="前端div水平居中的几种实现方式"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181421278.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-05</div><div class="title">前端div水平居中的几种实现方式</div></div></a></div><div><a href="/2cb9cb36.html" title="前端map标签(创建热点区域或是点击图片指定区域跳转对应链接))"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181443949.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-30</div><div class="title">前端map标签(创建热点区域或是点击图片指定区域跳转对应链接))</div></div></a></div><div><a href="/50b2d4ac.html" title="前端进度条和进度条流光效果"><img class="cover" src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181441417.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-29</div><div class="title">前端进度条和进度条流光效果</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="artalk-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://oss.ypggb.com/i/2025/07/01/pk26bw.png" onerror='this.onerror=null,this.src="/img/404.png"' alt="avatar"></div><div class="author-info__name">梦洁</div><div class="author-info__description">小小的字,有大大的梦想~分享我的前端学习过程,经历,错误,和一些其他折腾过程</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">182</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">101</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">73</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/superBiuBiuMan"><i class="fab fa-github"></i><span>关注下我(*￣▽￣*)</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:zmqdream@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">不断更新中,有问题请留言回复(会通过邮箱提醒~)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAHello-World"><span class="toc-number">1.</span> <span class="toc-text">第一个Hello World</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E4%BA%86%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">重要了解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#grant"><span class="toc-number">2.1.</span> <span class="toc-text">@grant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#match"><span class="toc-number">2.2.</span> <span class="toc-text">@match</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#require"><span class="toc-number">2.3.</span> <span class="toc-text">@require</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resource"><span class="toc-number">2.4.</span> <span class="toc-text">@resource</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-addElement"><span class="toc-number">2.5.</span> <span class="toc-text">@GM_addElement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0script-1"><span class="toc-number">2.5.1.</span> <span class="toc-text">添加script-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0script-%E6%8C%87%E5%90%91url"><span class="toc-number">2.5.2.</span> <span class="toc-text">添加script-指向url</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0style%E5%92%8Ccss%E7%9A%84link"><span class="toc-number">2.5.3.</span> <span class="toc-text">添加style和css的link</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-addStyle"><span class="toc-number">2.6.</span> <span class="toc-text">@GM_addStyle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-setValue"><span class="toc-number">2.7.</span> <span class="toc-text">@GM_setValue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-getValue"><span class="toc-number">2.8.</span> <span class="toc-text">@GM_getValue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-deleteValue"><span class="toc-number">2.9.</span> <span class="toc-text">@GM_deleteValue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-listValues"><span class="toc-number">2.10.</span> <span class="toc-text">@GM_listValues</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unsafeWindow"><span class="toc-number">2.11.</span> <span class="toc-text">unsafeWindow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-registerMenuCommand"><span class="toc-number">2.12.</span> <span class="toc-text">@GM_registerMenuCommand</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#run-at"><span class="toc-number">2.13.</span> <span class="toc-text">@run-at</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GM-xmlhttpRequest"><span class="toc-number">2.14.</span> <span class="toc-text">@GM_xmlhttpRequest</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#connect"><span class="toc-number">2.15.</span> <span class="toc-text">@connect</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.</span> <span class="toc-text">代码编写前置工作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C1-require%E5%BC%95%E5%85%A5%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">前置工作1-@require引入本地文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%B7%A5%E4%BD%9C2-%E6%B7%BB%E5%8A%A0jQuery%E4%BE%BF%E6%90%BADOM%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">前置工作2-添加jQuery便携DOM操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%AD%A3%E5%BC%8F%E7%BC%96%E5%86%99"><span class="toc-number">4.</span> <span class="toc-text">代码正式编写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BB%83%E4%B9%A0-1"><span class="toc-number">4.1.</span> <span class="toc-text">1.练习-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BB%83%E4%B9%A0-2-CSDN%E9%BB%91%E5%A4%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">2.练习-2-CSDN黑夜模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E9%A1%B5%E9%9D%A2%E9%BB%91%E5%A4%9C%E6%A8%A1%E5%BC%8F%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.2.1.</span> <span class="toc-text">2.1个人中心页面黑夜模式添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E6%96%87%E7%AB%A0%E5%86%85%E5%AE%B9%E9%BB%91%E5%A4%9C%E6%A8%A1%E5%BC%8F%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.2文章内容黑夜模式添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8B%E6%A8%A1%E6%8B%9F%E7%82%B9%E5%87%BB%E5%92%8C%E8%A1%A8%E5%8D%95%E5%A1%AB%E5%86%99"><span class="toc-number">4.3.</span> <span class="toc-text">3.脚本自动化之模拟点击和表单填写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E8%A7%86%E9%A2%91%E5%80%8D%E9%80%9F%E6%92%AD%E6%94%BE"><span class="toc-number">4.4.</span> <span class="toc-text">4.视频倍速播放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-bilibili%E4%B8%80%E9%94%AE%E4%B8%89%E8%BF%9E"><span class="toc-number">4.5.</span> <span class="toc-text">5.bilibili一键三连</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A8%B1%E8%8A%B1%E5%8A%A8%E6%BC%AB%E7%AE%80%E6%98%93%E5%8E%BB%E5%B9%BF%E5%91%8A"><span class="toc-number">4.6.</span> <span class="toc-text">6.樱花动漫简易去广告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-bilibili%E5%B0%8F%E5%B0%BE%E5%B7%B4-hook%E6%80%9D%E6%83%B3"><span class="toc-number">4.7.</span> <span class="toc-text">7.bilibili小尾巴-hook思想</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5"><span class="toc-number">5.</span> <span class="toc-text">链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7"><span class="toc-number">6.</span> <span class="toc-text">技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8GM-xmlhttpRequest%E7%9C%8B%E4%B8%8D%E5%88%B0%E8%AF%B7%E6%B1%82%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="toc-number">6.1.</span> <span class="toc-text">使用GM_xmlhttpRequest看不到请求怎么办?</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95"><span class="toc-number">7.</span> <span class="toc-text">错误记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#because-it-violates-the-following-Content-Security-Policy-directive"><span class="toc-number">7.1.</span> <span class="toc-text">because it violates the following Content Security Policy directive</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E6%9C%89-%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86formData%E5%8F%91%E9%80%81post%E6%95%B0%E6%8D%AE-%E4%B8%80%E5%AE%9A%E8%A6%81%E7%9C%81%E7%95%A5-xhr-setRequestHeader-%E2%80%98Content-Type%E2%80%99-%E2%80%98application-x-www-form-urlencoded%E2%80%99-%E8%BF%99%E8%A1%8C%E4%BB%A3%E7%A0%81-%E5%90%A6%E8%80%85%E6%95%B0%E6%8D%AE%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E5%88%87%E5%89%B2"><span class="toc-number">7.1.1.</span> <span class="toc-text">还有,如果设置了formData发送post数据,一定要省略 xhr.setRequestHeader(‘Content-Type’, ‘application&#x2F;x-www-form-urlencoded’); 这行代码,否者数据无法正常切割</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/31d04109.html" title="java枚举和mybaits-plus结合实现映射输出和存储">java枚举和mybaits-plus结合实现映射输出和存储</a><time datetime="2025-05-26T20:23:14.000Z" title="发表于 2025-05-26 20:23:14">2025-05-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/dc4ed705.html" title="qq农场,牧场解包查看导出swf文件内容图片"><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202503251433885.png" onerror='this.onerror=null,this.src="/img/404.png"' alt="qq农场,牧场解包查看导出swf文件内容图片"></a><div class="content"><a class="title" href="/dc4ed705.html" title="qq农场,牧场解包查看导出swf文件内容图片">qq农场,牧场解包查看导出swf文件内容图片</a><time datetime="2025-03-25T14:28:01.000Z" title="发表于 2025-03-25 14:28:01">2025-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ed2e6c27.html" title="移动云盘加密分析-以链接有消息检查为例子"><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202503251433302.png" onerror='this.onerror=null,this.src="/img/404.png"' alt="移动云盘加密分析-以链接有消息检查为例子"></a><div class="content"><a class="title" href="/ed2e6c27.html" title="移动云盘加密分析-以链接有消息检查为例子">移动云盘加密分析-以链接有消息检查为例子</a><time datetime="2025-03-22T12:24:10.000Z" title="发表于 2025-03-22 12:24:10">2025-03-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/3cde95bc.html" title="mstsc使用proxifier走clash代理降低延迟"><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202503030912164.png" onerror='this.onerror=null,this.src="/img/404.png"' alt="mstsc使用proxifier走clash代理降低延迟"></a><div class="content"><a class="title" href="/3cde95bc.html" title="mstsc使用proxifier走clash代理降低延迟">mstsc使用proxifier走clash代理降低延迟</a><time datetime="2025-03-03T09:11:01.000Z" title="发表于 2025-03-03 09:11:01">2025-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/d6a2907d.html" title="适配FASTGPT基础AI模板-适合对付领导突发AI-奇想而生的模板"><img src="https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202502201550402.png" onerror='this.onerror=null,this.src="/img/404.png"' alt="适配FASTGPT基础AI模板-适合对付领导突发AI-奇想而生的模板"></a><div class="content"><a class="title" href="/d6a2907d.html" title="适配FASTGPT基础AI模板-适合对付领导突发AI-奇想而生的模板">适配FASTGPT基础AI模板-适合对付领导突发AI-奇想而生的模板</a><time datetime="2025-02-20T15:45:25.000Z" title="发表于 2025-02-20 15:45:25">2025-02-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://dreamos.oss-cn-beijing.aliyuncs.com/gitblog/202403181436823.png)"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By 梦洁</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://lib.baomitu.com/fancyapps-ui/5.0.33/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{let t=null;const e=()=>{if(t=Artalk.init(Object.assign({el:"#artalk-wrap",server:"https://artalk.dreamlove.top",site:"梦洁小站",pageKey:location.pathname,darkMode:"dark"===document.documentElement.getAttribute("data-theme")},null)),"null"===GLOBAL_CONFIG.lightbox)return;t.on("list-loaded",()=>{t.ctx.get("list").getCommentNodes().forEach(t=>{const e=t.getRender().$content;btf.loadLightbox(e.querySelectorAll("img:not([atk-emoticon])"))})});btf.addGlobalFn("pjax",()=>{t.destroy()},"destroyArtalk")},a=async()=>{"object"==typeof Artalk||(await getCSS("https://lib.baomitu.com/artalk/2.8.2/Artalk.min.css"),await getScript("https://lib.baomitu.com/artalk/2.8.2/Artalk.min.js")),e()};btf.addGlobalFn("themeChange",e=>{const a=document.getElementById("artalk-wrap");if(!a||!a.children.length)return;const l="dark"===e;t.setDarkMode(l)},"artalk"),a()})()</script></div><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://lib.baomitu.com/butterfly-extsrc/1.1.3/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://lib.baomitu.com/algoliasearch/4.22.1/algoliasearch-lite.umd.min.js"></script><script src="https://lib.baomitu.com/instantsearch.js/4.65.0/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>